FROM python:3.7-alpine3.10
  
RUN pip install requests

COPY validate.py /usr/local/bin
COPY xnatSession.py /usr/local/bin

WORKDIR /usr/local/bin

LABEL org.nrg.commands="[{\"name\": \"validate-checksum\", \"description\": \"Validate uploaded DICOM with checksum\", \"version\": \"1.0\", \"schema-version\": \"1.0\", \"image\": \"radiologicskate/checksum-validator:1.0\", \"type\": \"docker\", \"command-line\": \"python validate.py --sessionId #SESSION_ID# --sessionLabel #SESSION_LABEL# --assignTo #USER# #CHECKSUM_RES# #CHECKSUM_SUBDIR# #SCAN_IDS#\", \"override-entrypoint\": true, \"mounts\": [{\"name\": \"input\", \"writable\": false, \"path\": \"#SESSION_DIR#\"}], \"environment-variables\": {}, \"ports\": {}, \"inputs\": [{\"name\": \"SCAN_IDS\", \"label\": \"Series IDs\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": \"--series\", \"command-line-separator\": \" \", \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": \"flag\"}, {\"name\": \"USER\", \"label\": \"User to whom query will be assigned\", \"description\": \"Enter the username for the user to whom queries ought to be assigned\", \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"SESSION_ID\", \"label\": \"Session ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"SESSION_LABEL\", \"label\": \"Session label\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"CHECKSUM_RES\", \"label\": \"Resource containing checksum txt files\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": \"--checksumResource\", \"command-line-separator\": \" \", \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"CHECKSUM_SUBDIR\", \"label\": \"Subdirectory within resource containing checksum txt files\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": \"--checksumSubdir\", \"command-line-separator\": \" \", \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}], \"outputs\": [], \"xnat\": [{\"name\": \"validate-checksum\", \"label\": \"Validate uploaded DICOM with checksum\", \"description\": \"Validate uploaded DICOM with checksum\", \"contexts\": [\"xnat:imageSessionData\"], \"external-inputs\": [{\"name\": \"session\", \"label\": \"Session\", \"description\": \"Input session\", \"type\": \"Session\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": \"input\", \"via-setup-command\": null, \"user-settable\": null, \"load-children\": true}], \"derived-inputs\": [{\"name\": \"session-id\", \"label\": \"Session ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"SESSION_ID\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"id\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"session-label\", \"label\": \"Session label\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"SESSION_LABEL\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"label\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"session-dir\", \"label\": null, \"description\": \"The session's archive dir\", \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": \"#SESSION_DIR#\", \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"directory\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"series\", \"label\": \"Series\", \"description\": null, \"type\": \"Scan\", \"matcher\": \"('DICOM' in @.resources[*].label || 'secondary' in @.resources[*].label)\", \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"SCAN_IDS\", \"provides-files-for-command-mount\": null, \"user-settable\": true, \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"id\", \"via-setup-command\": null, \"multiple\": true}, {\"name\": \"checksum-resource\", \"label\": \"Resource containing checksum txt files\", \"description\": null, \"type\": \"Resource\", \"matcher\": null, \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"user-settable\": true, \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": null, \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"checksum-resource-dir\", \"label\": \"Directory path for resource containing checksum txt files\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"CHECKSUM_RES\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"checksum-resource\", \"derived-from-xnat-object-property\": \"directory\", \"via-setup-command\": null, \"multiple\": false}], \"output-handlers\": []}]}]"
