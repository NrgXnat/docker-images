FROM python:3.7-alpine3.10

COPY script-generator.py /usr/local/bin


LABEL org.nrg.commands="[{\"name\": \"script-generator\", \"label\": \"Script generator\", \"description\": \"Generate script for processing XNAT data on external HPC\", \"version\": \"1.0\", \"schema-version\": \"1.0\", \"image\": \"radiologicskate/script-generator:latest\", \"type\": \"docker\", \"command-line\": \"python /usr/local/bin/script-generator.py --user \$XNAT_USER --passwd \$XNAT_PASS --host \$XNAT_HOST --template /input/script-template.txt --outputDir /output --projectId #projectId# --subjectId #subjectId# --subjectLabel #subjectLabel# --sessionId #sessionId# --sessionLabel #sessionLabel# #scanIds#\", \"override-entrypoint\": true, \"mounts\": [{\"name\": \"input\", \"writable\": false, \"path\": \"/input/script-template.txt\"}, {\"name\": \"output\", \"writable\": true, \"path\": \"/output\"}], \"environment-variables\": {}, \"ports\": {}, \"inputs\": [{\"name\": \"projectId\", \"label\": \"Project\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"subjectId\", \"label\": \"Subject ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"subjectLabel\", \"label\": \"Subject label\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"sessionId\", \"label\": \"Session ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"sessionLabel\", \"label\": \"Session label\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}, {\"name\": \"scanIds\", \"label\": \"Scans\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": \"--scanIds\", \"command-line-separator\": \" \", \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": \"comma\"}, {\"name\": \"scriptTemplate\", \"label\": \"Script template\", \"description\": \"Location of the template file from which we'll build the script\", \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"command-line-flag\": null, \"command-line-separator\": null, \"true-value\": null, \"false-value\": null, \"select-values\": [], \"multiple-delimiter\": null}], \"outputs\": [{\"name\": \"script\", \"description\": \"Output script\", \"required\": true, \"mount\": \"output\", \"path\": \"#sessionId#.sh\", \"glob\": null}], \"xnat\": [{\"name\": \"script-generator-session\", \"label\": \"Script generator\", \"description\": \"Perform a search and replace on script template to generate an extrernally runnable script\", \"contexts\": [\"xnat:imageSessionData\"], \"external-inputs\": [{\"name\": \"session\", \"label\": null, \"description\": \"Input session\", \"type\": \"Session\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"via-setup-command\": null, \"user-settable\": null, \"load-children\": true}], \"derived-inputs\": [{\"name\": \"project\", \"label\": \"Project\", \"description\": null, \"type\": \"Project\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": null, \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"project-id\", \"label\": \"Project ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"projectId\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": true, \"derived-from-wrapper-input\": \"project\", \"derived-from-xnat-object-property\": \"id\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"subject\", \"label\": \"Subject\", \"description\": null, \"type\": \"Subject\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": null, \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"subject-id\", \"label\": \"Subject ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"subjectId\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"subject\", \"derived-from-xnat-object-property\": \"id\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"subject-label\", \"label\": \"Subject label\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"subjectLabel\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"subject\", \"derived-from-xnat-object-property\": \"label\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"session-id\", \"label\": \"Session ID\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"sessionId\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"id\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"session-label\", \"label\": \"Session label\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"sessionLabel\", \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"label\", \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"scan\", \"label\": \"Scan(s)\", \"description\": null, \"type\": \"Scan\", \"matcher\": \"'DICOM' in @.resources[*].label\", \"default-value\": null, \"required\": false, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"scanIds\", \"provides-files-for-command-mount\": null, \"user-settable\": null, \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"id\", \"via-setup-command\": null, \"multiple\": true}, {\"name\": \"scriptTemplateDir\", \"label\": \"Script template-containing resource\", \"description\": null, \"type\": \"Resource\", \"matcher\": \"@.label =~ /.*templates.*/i\", \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"user-settable\": true, \"load-children\": true, \"derived-from-wrapper-input\": \"project\", \"derived-from-xnat-object-property\": null, \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"scriptTemplateFile\", \"label\": \"Script template file\", \"description\": null, \"type\": \"File\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": \"scriptTemplate\", \"provides-files-for-command-mount\": \"input\", \"user-settable\": true, \"load-children\": true, \"derived-from-wrapper-input\": \"scriptTemplateDir\", \"derived-from-xnat-object-property\": null, \"via-setup-command\": null, \"multiple\": false}, {\"name\": \"scriptTemplateFileName\", \"label\": \"Script template file name\", \"description\": null, \"type\": \"string\", \"matcher\": null, \"default-value\": null, \"required\": true, \"replacement-key\": null, \"sensitive\": null, \"provides-value-for-command-input\": null, \"provides-files-for-command-mount\": null, \"user-settable\": false, \"load-children\": false, \"derived-from-wrapper-input\": \"scriptTemplateFile\", \"derived-from-xnat-object-property\": \"name\", \"via-setup-command\": null, \"multiple\": false}], \"output-handlers\": [{\"name\": \"scriptFile\", \"accepts-command-output\": \"script\", \"via-wrapup-command\": null, \"as-a-child-of\": \"project\", \"type\": \"Resource\", \"label\": \"#scriptTemplateFileName#Scripts\", \"format\": null}]}]}]"
