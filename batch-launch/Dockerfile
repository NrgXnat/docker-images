FROM python:3.7.1-alpine3.8

RUN pip install --no-cache-dir \
        docopt \
        jsonpath \
        requests
COPY batch-launch.py /usr/local/bin
LABEL org.nrg.commands="[{\"name\": \"dcm2niix-subjects-batch\", \"description\": \"Launch dcm2niix containers on a batch of subjects\", \"type\": \"docker\", \"version\": \"1.1\", \"schema-version\": \"1.0\", \"image\": \"xnat/batch-launch:1.1\", \"command-line\": \"batch-launch.py subjects \$XNAT_HOST \$XNAT_USER \$XNAT_PASS dcm2niix-sessions-batch-subject #PROJECT# #PROJECT#\", \"override-entrypoint\": true, \"mounts\": [], \"inputs\": [{\"name\": \"PROJECT\", \"user-settable\": false, \"required\": true}], \"outputs\": [], \"xnat\": [{\"name\": \"dcm2niix-subjects-batch-project\", \"label\": \"dcm2niix batch\", \"description\": \"Launch dcm2niix-sessions-batch-subject on all subjects in a project\", \"contexts\": [\"xnat:projectData\"], \"external-inputs\": [{\"name\": \"project\", \"description\": \"Input project\", \"type\": \"Project\", \"required\": true, \"load-children\": false}], \"derived-inputs\": [{\"name\": \"project-id\", \"type\": \"string\", \"derived-from-wrapper-input\": \"project\", \"derived-from-xnat-object-property\": \"id\", \"provides-value-for-command-input\": \"PROJECT\", \"user-settable\": false, \"required\": true}], \"output-handlers\": []}]}, \
	{\"name\": \"dcm2niix-scans-batch\", \"description\": \"Launch dcm2niix containers on a batch of scans\", \"type\": \"docker\", \"version\": \"1.1\", \"schema-version\": \"1.0\", \"image\": \"xnat/batch-launch:1.1\", \"command-line\": \"batch-launch.py scans \$XNAT_HOST \$XNAT_USER \$XNAT_PASS dcm2niix-scan #SESSION_ID# #PROJECT#\", \"override-entrypoint\": true, \"mounts\": [], \"inputs\": [{\"name\": \"PROJECT\", \"user-settable\": false, \"required\": true}, {\"name\": \"SESSION_ID\", \"user-settable\": false, \"required\": true}], \"outputs\": [], \"xnat\": [{\"name\": \"dcm2niix-scans-batch-session\", \"label\": \"dcm2niix batch\", \"description\": \"Launch dcm2niix-scan on all scans in a session\", \"contexts\": [\"xnat:imageSessionData\"], \"external-inputs\": [{\"name\": \"session\", \"description\": \"Input session\", \"type\": \"Session\", \"required\": true, \"load-children\": false}], \"derived-inputs\": [{\"name\": \"project\", \"type\": \"string\", \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"project-id\", \"provides-value-for-command-input\": \"PROJECT\", \"user-settable\": false, \"required\": true}, {\"name\": \"session-id\", \"type\": \"string\", \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"id\", \"provides-value-for-command-input\": \"SESSION_ID\", \"user-settable\": false, \"required\": true}], \"output-handlers\": []}]}, \
	{\"name\": \"dcm2niix-sessions-batch\", \"description\": \"Launch dcm2niix containers on a batch of sessions\", \"type\": \"docker\", \"version\": \"1.1\", \"schema-version\": \"1.0\", \"image\": \"xnat/batch-launch:1.1\", \"command-line\": \"batch-launch.py sessions \$XNAT_HOST \$XNAT_USER \$XNAT_PASS dcm2niix-scans-batch-session #SUBJECT_ID# #PROJECT#\", \"override-entrypoint\": true, \"mounts\": [], \"inputs\": [{\"name\": \"PROJECT\", \"user-settable\": false, \"required\": true}, {\"name\": \"SUBJECT_ID\", \"user-settable\": false, \"required\": true}], \"outputs\": [], \"xnat\": [{\"name\": \"dcm2niix-sessions-batch-subject\", \"label\": \"dcm2niix batch\", \"description\": \"Launch dcm2niix-scans-batch-session on all sessions in a subject\", \"contexts\": [\"xnat:subjectData\"], \"external-inputs\": [{\"name\": \"subject\", \"description\": \"Input subject\", \"type\": \"Subject\", \"required\": true, \"load-children\": false}], \"derived-inputs\": [{\"name\": \"project\", \"type\": \"string\", \"derived-from-wrapper-input\": \"subject\", \"derived-from-xnat-object-property\": \"project-id\", \"provides-value-for-command-input\": \"PROJECT\", \"user-settable\": false, \"required\": true}, {\"name\": \"subject-id\", \"type\": \"string\", \"derived-from-wrapper-input\": \"subject\", \"derived-from-xnat-object-property\": \"id\", \"provides-value-for-command-input\": \"SUBJECT_ID\", \"user-settable\": false, \"required\": true}], \"output-handlers\": []}]}]"
